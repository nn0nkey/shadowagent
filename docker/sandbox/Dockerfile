FROM python:3.11-slim

# ğŸ”¥ é…ç½®APTæ¸…åæº
RUN sed -i 's/deb.debian.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list.d/debian.sources && \
    sed -i 's/security.debian.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list.d/debian.sources

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc \
    g++ \
    git \
    curl \
    wget \
    libxml2-dev \
    libxslt1-dev \
    zlib1g-dev \
    libffi-dev \
    libssl-dev \
    && rm -rf /var/lib/apt/lists/*

# ğŸ”¥ é…ç½®PIPæ¸…åæº
RUN pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple

# ğŸ”¥ åˆ†é˜¶æ®µå®‰è£…æ¸—é€æµ‹è¯•åº“ï¼ˆé¿å…ä¾èµ–å†²çªï¼‰
# ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒHTTPå’Œè§£æåº“
RUN pip install --no-cache-dir --upgrade pip setuptools wheel && \
    pip install --no-cache-dir \
    requests httpx aiohttp urllib3 \
    beautifulsoup4 lxml html5lib \
    pyyaml pycryptodome cryptography \
    pyjwt chardet

# ç¬¬äºŒé˜¶æ®µï¼šWebæ¡†æ¶å’Œå·¥å…·
RUN pip install --no-cache-dir \
    flask jinja2 \
    pymysql redis \
    python-dateutil pytz \
    colorama tqdm click \
    validators

# ç¬¬ä¸‰é˜¶æ®µï¼šç½‘ç»œå’Œæ¸—é€å·¥å…·
RUN pip install --no-cache-dir \
    websocket-client pysocks \
    pillow

# åˆ›å»ºå·¥ä½œç›®å½•
WORKDIR /sandbox

# ğŸ”¥ érootç”¨æˆ·æ‰§è¡Œï¼ˆå¢åŠ å®‰å…¨æ€§ï¼‰
RUN useradd -m -u 1000 sandbox && chown -R sandbox:sandbox /sandbox
USER sandbox

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV PYTHONUNBUFFERED=1
ENV PYTHONIOENCODING=utf-8

CMD ["python3"]